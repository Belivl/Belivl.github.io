---
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import { ViewTransitions } from "astro:transitions";
import bgPic from "../assets/FilmGrainS5.jpg";
import { getLocale } from "astro-i18n-aut";
const locale = getLocale(Astro.url);
import Coin from "../components/dragons/CoinDragon.astro";
import "../styles/dragons.css";
---

<html lang={locale} class="dark">
  <head>
    <BaseHead
      title="Portfolio Choice"
      description="Enter desired portfolio site"
      image=""
    />
    <ViewTransitions />
  </head>
  <body class="bg-grey-500">
    <!--Background image -->
    <div class="bgColor bg-light dark:bg-grey-500 fixed w-full h-full -z-50">
    </div>
    <img src={bgPic.src} alt="X" class="mainBG" />
    <img
      src="/FlameSide.svg"
      alt="Y"
      class="mainBG2 fixed top-1/2 -translate-y-1/2 left-0 scale-50 md:scale-100 origin-left"
      style="z-index: -10;"
    />
    <img
      src="/FlameSide.svg"
      alt="Y"
      class="mainBG2 fixed top-1/2 -translate-y-1/2 right-0 rotate-180 scale-50 md:scale-100 origin-left translate-x-[100%]"
      style="z-index: -10;"
    />
    <div>
      <main
        id="main"
        class="w-full flex flex-col items-center justify-center p-4 h-full"
      >
        <div class="container mx-auto">
          <!--Temp drag test -->
          <div id="pile3">
            <div class="card3">Card 1</div>
            <div class="card3">Card 2</div>
            <div class="card3">Card 3</div>
          </div>

          <div id="deck3"></div>

          <script>
            // Define the drag function in the global scope
            (window as any).drag = function (ev) {
              const target = ev.target as HTMLDivElement;
              ev.dataTransfer?.setData("text", target.textContent || "");
              target.classList.add("dragging");
            };

            // Define the allowDrop function in the global scope
            (window as any).allowDrop = function (ev) {
              ev.preventDefault();
            };

            // Define the drop function in the global scope
            (window as any).drop = function (ev) {
              ev.preventDefault();
              const data = ev.dataTransfer?.getData("text");
              const target = ev.target as HTMLDivElement;
              if (!data || !target) return;

              const card3 = document.createElement("div");
              card3.className = "card";
              card3.textContent = data;
              target.appendChild(card3);

              // Remove the card from the source pile
              const sourcePile = document.getElementById(
                "pile3"
              ) as HTMLDivElement;
              const draggedCard = sourcePile.querySelector(
                ".dragging"
              ) as HTMLDivElement | null;
              if (draggedCard) {
                draggedCard.parentNode?.removeChild(draggedCard);
              }
              target.classList.remove("dragging");
            };

            // Dynamically set ondragstart, ondragover, and ondrop functions for all elements with class "card"
            document.querySelectorAll(".card3").forEach(function (card) {
              card.setAttribute("draggable", "true");
              card.addEventListener("dragstart", (window as any).drag);
              card.addEventListener("dragover", (window as any).allowDrop);
              card.addEventListener("drop", (window as any).drop);
            });
            const deck3 = document.getElementById("deck3");
            if (deck3) {
              deck3.addEventListener("drop", (window as any).drop);
              deck3.addEventListener("dragover", (window as any).allowDrop);
            }
          </script>

          <!-- -->

          <div class="flex flex-row gap-9">
            <div class="flex flex-col gap-24 w-1/3">
              <div class="flex flex-col gap-9 bg-red-800">
                <h1 class="text-[orange] mb-12 text-[2rem]">Dragons</h1>
                <div class="flex gap-9">
                  <div>Info</div>
                  <div>
                    <div>Coins</div>
                    <div class="flex flex-col gap-0">
                      <div>Player1: <span id="winning1">0</span></div>
                      <div>Player2: <span id="winning2">0</span></div>
                    </div>
                    <div>Simulate win</div>
                    <div class="w-full flex flex-col gap-2">
                      <button
                        id="win1"
                        class="bg-green-500 text-black p-2 rounded w-full"
                        >Player 1</button
                      >
                      <button
                        id="win2"
                        class="bg-green-500 text-black p-2 rounded w-full"
                        >Player 2</button
                      >
                    </div>
                  </div>

                  <div>
                    <div>Cards turned</div>
                    <div class="flex gap-2">
                      <div>Player1:</div>
                      <div>0</div>
                    </div>
                    <div class="flex gap-2">
                      <div>Player2:</div>
                      <div>0</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="grid grid-cols-3 gap-3">
                <div class="flex flex-col gap-3">
                  <div id="cardStack" class="card-placed card-back">Stack</div>
                  <div>Take</div>
                  <div class="grid grid-cols-3 grid-rows-2 gap-2 w-full">
                    <div class="btnPlace1">1</div>
                    <div class="btnPlace1">2</div>
                    <div class="btnPlace1">3</div>
                    <div class="btnPlace1">4</div>
                    <div class="btnPlace1">5</div>
                    <div class="btnPlace1">6</div>
                  </div>
                  <div>Put down</div>
                  <div class="grid grid-cols-3 grid-rows-2 gap-2 w-full">
                    <div class="btnPlace1">1</div>
                    <div class="btnPlace1">2</div>
                  </div>
                </div>

                <div class="flex flex-col gap-3">
                  <div id="cardStackOpen1" class="card-placed bg-goldTips2-500">
                    1
                  </div>
                  <div class="w-full flex flex-col gap-3">
                    <div>Take</div>
                    <div
                      id="cardStackTake"
                      class="grid grid-cols-3 grid-rows-2 gap-2 w-full"
                    >
                      <div class="btnPlace1">1</div>
                      <div class="btnPlace1">2</div>
                      <div class="btnPlace1">3</div>
                      <div class="btnPlace1">4</div>
                      <div class="btnPlace1">5</div>
                      <div class="btnPlace1">6</div>
                    </div>
                  </div>
                </div>

                <div class="flex flex-col gap-3">
                  <div id="cardStackOpen2" class="card-placed bg-goldTips2-100">
                    2
                  </div>
                  <div>Take</div>
                  <div class="grid grid-cols-3 grid-rows-2 gap-2 w-full">
                    <div class="btnPlace1">1</div>
                    <div class="btnPlace1">2</div>
                    <div class="btnPlace1">3</div>
                    <div class="btnPlace1">4</div>
                    <div class="btnPlace1">5</div>
                    <div class="btnPlace1">6</div>
                  </div>
                </div>
              </div>
              <div class="grid bg-blue-700 gap-3 w-full">
                <!--Deck creation works -->
                <div class="flex-col gap-1 hidden">
                  <h2>Deck</h2>
                  <div id="deck-container" class="flex gap-3 flex-wrap"></div>
                </div>
                <div class="hidden flex-col gap-1">
                  <h2>Shuffled Deck</h2>
                  <div
                    id="shuffled-cont"
                    class="flex gap-3 flex-wrap bg-red-300 text-black"
                  >
                  </div>
                </div>
              </div>
            </div>

            <div class="column-main flex flex-col gap-16">
              <div id="player2Deck" class="grid gap-3 grid-cols-3 grid-rows-2">
                <div class="card-placed card-back">1</div>
                <div class="card-placed card-back">2</div>
                <div class="card-placed card-back">3</div>
                <div class="card-placed card-back">4</div>
                <div class="card-placed card-back">5</div>
                <div class="card-placed card-back">6</div>
              </div>
              <div class="w-full h-16">
                <h3 class="text-center">
                  Player <span id="playerTurn">1</span> Turn
                </h3>
              </div>
              <div id="player1Deck" class="grid gap-3 grid-cols-3 grid-rows-2">
                <div class="card-placed card-back">1</div>
                <div class="card-placed card-back">2</div>
                <div class="card-placed card-back">3</div>
                <div class="card-placed card-back">4</div>
                <div class="card-placed card-back">5</div>
                <div class="card-placed card-back">6</div>
              </div>
            </div>
            <div class="flex flex-col justify-between">
              <div id="coin-pile-player1" class="flex flex-col gap-3">
                <Coin />
                <Coin />
                <Coin />
              </div>
              <div class="coin-pile relative">
                <div class="absolute -top-8 left-0 z-[11]">
                  <Coin />
                </div>
                <div class="absolute -top-4 left-0 z-10">
                  <Coin />
                </div>
                <div class="absolute shadow-lg top-0 left-0">
                  <Coin />
                </div>
              </div>
              <div id="coin-pile-player2" class="flex flex-col gap-3">
                <Coin />
                <Coin />
                <Coin />
              </div>
            </div>
          </div>
        </div>
      </main>
      <Footer />

      <script src="./../js/dragons.ts"></script>

      <style>
        html,
        body {
          height: 100dvh;
        }
        body {
          height: 100dvh;
          display: grid;
          margin-inline: auto;
        }
      </style>
    </div>
  </body>
</html>
