---
import Layout from "../../layouts/Layout.astro";
---

<Layout>
  <!--Temp drag test -->
  <div id="pile3">
    <div class="card3">Card 1</div>
    <div class="card3">Card 2</div>
    <div class="card3">Card 3</div>
  </div>

  <div id="deck3"></div>
</Layout>

<script>
  // Define the drag function in the global scope
  (window as any).drag = function (ev) {
    const target = ev.target as HTMLDivElement;
    ev.dataTransfer?.setData("text", target.textContent || "");
    target.classList.add("dragging");
  };

  // Define the allowDrop function in the global scope
  (window as any).allowDrop = function (ev) {
    ev.preventDefault();
  };

  // Define the drop function in the global scope
  (window as any).drop = function (ev) {
    ev.preventDefault();
    const data = ev.dataTransfer?.getData("text");
    const target = ev.target as HTMLDivElement;
    if (!data || !target) return;

    const card3 = document.createElement("div");
    card3.className = "card";
    card3.textContent = data;
    target.appendChild(card3);

    // Remove the card from the source pile
    const sourcePile = document.getElementById("pile3") as HTMLDivElement;
    const draggedCard = sourcePile.querySelector(
      ".dragging"
    ) as HTMLDivElement | null;
    if (draggedCard) {
      draggedCard.parentNode?.removeChild(draggedCard);
    }
    target.classList.remove("dragging");
  };

  // Dynamically set ondragstart, ondragover, and ondrop functions for all elements with class "card"
  document.querySelectorAll(".card3").forEach(function (card) {
    card.setAttribute("draggable", "true");
    card.addEventListener("dragstart", (window as any).drag);
    card.addEventListener("dragover", (window as any).allowDrop);
    card.addEventListener("drop", (window as any).drop);
  });
  const deck3 = document.getElementById("deck3");
  if (deck3) {
    deck3.addEventListener("drop", (window as any).drop);
    deck3.addEventListener("dragover", (window as any).allowDrop);
  }
</script>

<style>
  #pile,
  #deck3 {
    border: 2px solid #000;
    padding: 10px;
    width: 150px;
    margin: 10px;
    display: inline-block;
  }

  .card3 {
    border: 1px solid #000;
    background-color: #ccc;
    padding: 5px;
    margin: 5px;
    cursor: pointer;
  }

  .card3.dragging {
    opacity: 0.5;
  }
</style>
